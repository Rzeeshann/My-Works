<!DOCTYPE html>
<html>
    <body>
        <form onSubmit = "saveToLocalStorage(event)">
            <label> ChooseExpenseAmount </label> 
            <input id = 'amt' type = "amt" name="number" required/>
            <label> ChooseDescription </label> 
            <input id = 'desc' type = "desc" name="text" required/>
            <label for = "ChooseCategory"> Choose Category: </label>
            <select id = "category" name ="category">
            <option value = "food"> food </option>
            <option value = "movie"> movie </option>
            <option value = "vacation"> vacation </option>
            <option value = "homebill"> homebill </option>
            <option value = "rent"> rent </option>
            </select>
            <button> Submit </button>
        </form>
        <ul id = 'listofexpenses'></ul> 
        <script>
            function saveToLocalStorage(event){
                event.preventDefault();//preventDefault() method cancels the event if it is cancelable
                const amt = event.target.number.value;
                const desc = event.target.text.value;
                const category = event.target.category.value;   
                const obj = {
                    amt,
                    desc,
                    category,
                }
                localStorage.setItem(obj.desc, JSON.stringify(obj))
                showNewUserOnScreen(obj);
            } 
            window.addEventListener("DOMContentLoaded", () => {
                const localStorageObj = localStorage;
                const localstoragekeys  = Object.keys(localStorageObj)

                for(var i =0; i< localstoragekeys.length; i++){
                    const key = localstoragekeys[i]
                    const userDetailsString = localStorageObj[key];
                    const userDetailsObj = JSON.parse(userDetailsString);
                    showNewUserOnScreen(userDetailsObj)
                }
            })

            function showNewUserOnScreen(user){
                const parentNode = document.getElementById('listofexpenses');
                const childHTML = `<li id=${user.desc}> ${user.amt} - ${user.desc} -  ${user.category} 
                                        <button onclick=deleteUser('${user.desc}')> Delete User </button>
                                        <button onclick=editUserDetails('${user.desc}'), ('${user.amt}'), ('${user.category}'), '> Edit User </button>
                                     </li>`

                parentNode.innerHTML = parentNode.innerHTML + childHTML;
            }

            function editUserDetails(desc,amt,category){
                document.getElementById('amt').value = amt;
                document.getElementById('desc').value = desc;
                document.getElementById('category').value = category;

                deleteUser(desc,amt,category)
            }


            function deleteUser(desc){
                console.log(desc)
                localStorage.removeItem(desc);
                removeUserFromScreen(desc);

            }

            function removeUserFromScreen(desc){
                const parentNode = document.getElementById('listofexpenses');
                const childNodeToBeDeleted = document.getElementById(desc);

                parentNode.removeChild(childNodeToBeDeleted)
            }

            
        </script>
    </body>
</html>